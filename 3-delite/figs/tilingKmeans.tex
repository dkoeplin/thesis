\hspace{-0.105\textwidth}
\centering\begin{tabular}{cm{0.45\textwidth}m{0.01\textwidth}m{0.44\textwidth}}
{} &
{\begin{lstlisting}
(sums,counts) = multiFold(n/b0)((k,d),k)(...){ii =>
(*@\color{vbgray}{\vrule}@*)  pt1Tile = points.copy(b0 + ii, *)
(*@\color{vbgray}{\vrule}@*)
(*@\color{vbgray}{\vrule}@*)  multiFold(b0)((k,d),k)(zeros(1,d),0){ i =>
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  pt1 = pt1Tile.slice(i, *)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  minDistWithIndex = multiFold(k/b1)(1)((max, -1)){ jj =>
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  pt2Tile = centroids.copy(b1 + jj, *)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  minIndTile = fold(b1)((max,-1)){ j =>
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  pt2 = pt2Tile.slice(j, *)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  dist = distance(pt1, pt2)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  acc => if (acc._1 < dist) acc else (dist, j+jj)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  }{ (a,b) => if (a._1 < b._1) a else b }
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (0, {acc =>
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)    if (acc._1 < minIndTile._1) acc
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)    else minIndTile
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  })
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  }{(a,b) =>
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)    if (a._1 < b._1) a else b
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  }
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  minDistIndex = minDistWithIndex._2
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  sumFunc = ... // Fig 4: lines 17-20
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  countFunc = ... // Fig 4: line 21
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (sumFunc, countFunc)
(*@\color{vbgray}{\vrule}@*)  }{(a,b) => ... /* Tiled combination function */ }
(*@\color{vbgray}{\vrule}@*)  (0, acc => ... /* Tiled combination function */ )
}{(a,b) => ... /* Tiled combination function */ }
}
\end{lstlisting}} & \hfill &
%\end{minipage} \hfill
%\begin{minipage}[b]{.4\textwidth}
{\begin{lstlisting}
(sums,counts) = multiFold(n/b0)((k,d),k)(...){ ii =>
(*@\color{vbgray}{\vrule}@*)  pt1Tile = points.copy(b0 + ii, *)
(*@\color{vbgray}{\vrule}@*)  minDistWithInds =
(*@\color{vbgray}{\vrule}@*)    multiFold(k/b1)(b1)(map(b1)((max, -1))){ jj =>
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  pt2Tile = centroids.copy(b1 + jj, *)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  minIndsTile = map(b0){ i =>
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  pt1 = pt1Tile.slice(i, *)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  minIndTile = fold(b1)((max,-1)){ j =>
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  pt2 = pt2Tile.slice(j, *)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  dist = distance(pt1, pt2)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  acc => if (acc._1 < dist) acc else (dist, j+jj)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  }{ (a,b) => if (a._1 < b._1) a else b }
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  }
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (0, acc => map(b0){ i =>
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)    if (acc(i)._1 < minIndsTile(i)._1) acc
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)    else minIndsTile(i)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  })
(*@\color{vbgray}{\vrule}@*)  }{(a,b) =>
(*@\color{vbgray}{\vrule}@*)    map(b0){i => if (a(i)._1 < b(i)._1) a(i) else b(i) }
(*@\color{vbgray}{\vrule}@*)  }
(*@\color{vbgray}{\vrule}@*)  multiFold(b0)(k,d)(zeros(k,d)){ i =>
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  pt1 = pt1Tile.slice(i, *)
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  minDistIndex = minDistWithInds(i)._2
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  sumFunc = ... // Fig 4: lines 17-20
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  countFunc = ... // Fig 4: line 21
(*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (sumFunc, countFunc)
(*@\color{vbgray}{\vrule}@*)  }{(a,b) => ... /* Tiled combination function */ }
(*@\color{vbgray}{\vrule}@*)  (0, acc => ... /* Tiled combination function */ )
}{(a,b) => ... /* Tiled combination function */ }
}
\end{lstlisting}}
\end{tabular}

\vspace{-0.2in}\begin{tabular}{cc}
{\parbox{0.45\textwidth}{\centering{a. Strip mined $k$-means in PPL.}}} &
{\parbox{0.5\textwidth}{\centering{b. Pattern interchanged $k$-means in PPL.}}}
\end{tabular}

%\vspace{-0.045\textwidth}
\hspace{-0.180\textwidth}
\centering\begin{tabular}{cm{0.45\textwidth}m{0.01\textwidth}m{0.44\textwidth}}
{} &
{\begin{lstlisting}[numbers=none,language=Pseudo]
1     For each tile of b0 points:
2     (*@\color{vbgray}{\vrule}@*)  Copy the points tile into local memory
3 - 4 (*@\color{vbgray}{\vrule}@*)  (*@\textbf{\color{blue}{For each point \emph{pt1} in the points tile}}@*):
5     (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\textbf{\color{red}{For each tile of b1 centroids}}@*):
6     (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Copy the centroids tile into local memory
7 - 8 (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  For each centroid (*@\emph{pt2}@*) in the centroids tile:
9     (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Compute distance between (*@\emph{pt1}@*) and (*@\emph{pt2}@*)
10-11 (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Keep the closest (index,distance) pair
      (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  End
13-16 (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Keep the closest pair across tiles
      (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  End
20    (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Extract the index of the closest centroid
21    (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Add (*@\emph{pt1}@*) to row minDistIndex
22    (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Increment count at minDistIndex
24    (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Add point and count sums across tiles
      (*@\color{vbgray}{\vrule}@*)  End
25-26 (*@\color{vbgray}{\vrule}@*)  Add point and count sums across tiles
      End
\end{lstlisting}} & \hfill &
%\end{minipage} \hfill
%\begin{minipage}[b]{.4\textwidth}
{\begin{lstlisting}[numbers=none,language=Pseudo]
1     For each tile of b0 points:
2     (*@\color{vbgray}{\vrule}@*)  Copy the points tile into local memory
3     (*@\color{vbgray}{\vrule}@*)  (*@\color{red}{\textbf{For each tile of b1 centroids}}@*):
4     (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Copy the centroids tile into local memory
5 - 6 (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{blue}{\textbf{For~each~point~\emph{pt1}~in~the~points~tile:}}@*)
7 - 8 (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  For each centroid (*@\emph{pt2}@*) in the centroids tile:
9     (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Compute distance between (*@\emph{pt1}@*) and (*@\emph{pt2}@*)
10-11 (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Keep the closest (index,distance) pair
      (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  End
      (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  End
13-16 (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  For each point: keep the closest pair across tiles
      (*@\color{vbgray}{\vrule}@*)  End
18-19 (*@\color{vbgray}{\vrule}@*)  (*@\color{blue}{\textbf{For each point \emph{pt1} in points tile}}@*):
20    (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Extract the index of the closest centroid
21    (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Add (*@\emph{pt1}@*) to row minDistIndex
22    (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Increment count at minDistIndex
24    (*@\color{vbgray}{\vrule}@*)  (*@\color{vbgray}{\vrule}@*)  Add point and count sums across tiles
      (*@\color{vbgray}{\vrule}@*)  End
25-26 (*@\color{vbgray}{\vrule}@*)  Add point and count sums across tiles
      End
\end{lstlisting}}
\end{tabular}


\vspace{-0.2in}\begin{tabular}{cc}
{\parbox{0.45\textwidth}{\centering{c. Pseudocode description of strip mined $k$-means.}}} &
{\parbox{0.5\textwidth}{\centering{d. Pseudocode description of pattern interchanged $k$-means.}}}
\end{tabular}

\vspace{0.1in}
\footnotesize{\begin{tabular}{|l|cc|cc|cc|}

\noalign{\hrule height 1.5pt}
\multicolumn{1}{|c|}{} & \multicolumn{2}{c|}{\bf Fused} & \multicolumn{2}{c|}{\bf Strip Mined}  & \multicolumn{2}{c|}{\bf Interchanged} \\
& DRAM Reads & Local Size & DRAM Reads & Local Size & DRAM Reads & Local Size \\ \hline
\emph{points} & $n \times d$ & $d$ & $n \times d$ & $b_0 \times d$ & $n \times d$ & $b_0 \times d$ \\ \hline
\emph{centroids} & $n \times k \times d$ & $d$ & $n \times k \times d$ & $b_1 \times d$ & $(n/b_0) \times k \times d$ & $b_1 \times d$ \\ \hline
\emph{minDistWithIndex} & $0$ & $2$ & $0$ & $2$ & $0$ & $2 \times b_0$ \\
\noalign{\hrule height 1.5pt}
\end{tabular}}

\small
\vspace{0.1in}\centering{(e) Minimum number of words read from DRAM (main memory) and on-chip storage for data structures within $k$-means clustering after each IR transformation.}
